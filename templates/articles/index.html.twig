{% extends 'base.html.twig' %}

{% block title %}Lista Artykułów{% endblock %}

{% block body %}

<div class="modal fade" id="articleDeleteModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Usuń artykuł</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <form action={{ path('delete_article') }} method="post">
          <p>Czy na pewno chcesz usunąć ten artykuł?</p>
          <input type="hidden" name="article_id" id="artcl_id" value="">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Anuluj</button>
          <button type="submit" class="btn btn-danger" onclick=>Usuń</button>
        </form>
      </div>
    </div>

  </div>
</div>

  {% for message in app.flashes('success') %}
    <div class="alert alert-success">
      {{ message }}
    </div>
  {% endfor %}

  {% if articles %}
    <table id="articles" class="table table-striped">
      <thead>
        <tr>
          <th>Tytuł</th>
          <th>Autor</th>
          <th>Utworzono</th>
          <th>Opublikowano</th>
          <th>Fragment</th>
          <th>Akcje</th>
        </tr>
      </thead>
      <tbody>
        {% for article in articles %}
          <tr>
            <td>{{ article.title }}</td>
            <td>{{ article.authorEmail }}</td>
            <td>{{ article.createdAt|date('d-m-Y') }}</td>
            <td>{{ article.isPublished ? 'Tak' : 'Nie' }}</td>
            <td>{{ article.body|truncate(100, true, '(...)')|wordwrap(30)|nl2br }}</td>
            <td>
              <a href={{ path('article_show', { 'id': article.id })}} class="btn btn-primary">Pokaż</a>

              {% if is_granted('ROLE_ADMIN') %}
                <a href={{ path('edit_article', { 'id': article.id }) }} class="btn btn-light">Edytuj</a>
                <button class="btn btn-danger delete-article" data-toggle="modal"
                  data-target="#articleDeleteModal" data-articleid={{ article.id }}>Usuń
                </button>

              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
    </table>
  {% else %}
    <p>Brak artykułów</p>
  {% endif %}
{% endblock %}

{% block javascripts %}
  <script>
    $('#articleDeleteModal').on('show.bs.modal', function(event){
      var button = $(event.relatedTarget)
      var article_id = button.data('articleid')
      var mdl = $(this)

      mdl.find('.modal-body #artcl_id').val(article_id);
    })
  </script>
{% endblock %}
